<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Shiny for Survival analysis</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Shiny for Survival analysis</h1>
</header>
<p>This is a very early attempt to seed Shiny projects whose source code is available from</p>
<p><a href="https://github.com/jinghuazhao/ShinyApps/">https://github.com/jinghuazhao/ShinyApps/</a></p>
<p>It would however be appropriate for clinicians who know the concepts of survival analysis in clinical trials but nevertheless find difficulties with use of statistical packages such as SAS, Stata or R.</p>
<p>An end-user can upload his/her own data for analysis and download the analysis report. The following aspects are experimented with data from R/survival package as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(survival<span class="sc">::</span>lung,<span class="at">file=</span><span class="st">&quot;lung.csv&quot;</span>,<span class="at">quote=</span><span class="cn">FALSE</span>,<span class="at">row.names=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<h1 id="data">Data</h1>
<p>This takes a local file in .csv or .tsv format, such as <code>lung.tsv</code> from above.</p>
<h1 id="download">Download</h1>
<p>The input data can be saved in a variety of format – is is actaully a template for downloading results.</p>
<h1 id="model">Model</h1>
<p>Once the data is uploaded, this defines the model as in the example.</p>
<h1 id="report">Report</h1>
<p>This is a file containing the commands and plots. For the current example, we have</p>
<h2 id="kaplan-meier-curve">Kaplan-Meier curve</h2>
<p>These were from vignettes of the <a href="https://CRAN.R-project.org/package=survminer">survminer</a> package. Note most of them are NOT implemented here.</p>
<p><img src="www/km-1.png" title="plot of chunk km" alt="plot of chunk km" style="display:block; margin: auto" style="display: block; margin: auto;" /><img src="www/km-2.png" title="plot of chunk km" alt="plot of chunk km" style="display:block; margin: auto" style="display: block; margin: auto;" /><img src="www/km-3.png" title="plot of chunk km" alt="plot of chunk km" style="display:block; margin: auto" style="display: block; margin: auto;" /><img src="www/km-4.png" title="plot of chunk km" alt="plot of chunk km" style="display:block; margin: auto" style="display: block; margin: auto;" /><img src="www/km-5.png" title="plot of chunk km" alt="plot of chunk km" style="display:block; margin: auto" style="display: block; margin: auto;" /><img src="www/km-6.png" title="plot of chunk km" alt="plot of chunk km" style="display:block; margin: auto" style="display: block; margin: auto;" /><img src="www/km-7.png" title="plot of chunk km" alt="plot of chunk km" style="display:block; margin: auto" style="display: block; margin: auto;" /><img src="www/km-8.png" title="plot of chunk km" alt="plot of chunk km" style="display:block; margin: auto" style="display: block; margin: auto;" /><img src="www/km-9.png" title="plot of chunk km" alt="plot of chunk km" style="display:block; margin: auto" style="display: block; margin: auto;" /></p>
<h2 id="cox-survival-curve">Cox survival curve</h2>
<p><img src="www/cox-1.png" title="plot of chunk cox" alt="plot of chunk cox" style="display:block; margin: auto" style="display: block; margin: auto;" /></p>
<hr />
<h2 id="appendix-survminer-vignette">Appendix (<a href="https://cran.r-project.org/web/packages/survminer/vignettes/Specifiying_weights_in_log-rank_comparisons.html">survminer vignette</a>)</h2>
<blockquote>
<h1 id="log-rank-statistic-for-2-groups">Log-rank statistic for 2 groups</h1>
<p>As it is stated in the literature, the Log-rank test for comparing survival (estimates of survival curves) in 2 groups (<span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>) is based on the below statistic</p>
<p><span class="math display">\[LR = \frac{U^2}{V} \sim \chi(1),\]</span></p>
<p>where <span class="math display">\[U = \sum_{i=1}^{T}w_{t_i}(o_{t_i}^A-e_{t_i}^A), \ \ \ \ \ \ \ \ V = Var(U) = \sum_{i=1}^{T}(w_{t_i}^2\frac{n_{t_i}^An_{t_i}^Bo_{t_i}(n_{t_i}-o_{t_i})}{n_{t_i}^2(n_{t_i}-1)})\]</span> and</p>
<ul>
<li><span class="math inline">\(t_i\)</span> for <span class="math inline">\(i=1, \dots, T\)</span> are possible event times,</li>
<li><span class="math inline">\(n_{t_i}\)</span> is the overall risk set size on the time <span class="math inline">\(t_i\)</span> (<span class="math inline">\(n_{t_i} = n_{t_i}^A+n_{t_i}^B\)</span>),</li>
<li><span class="math inline">\(n_{t_i}^A\)</span> is the risk set size on the time <span class="math inline">\(t_i\)</span> in group <span class="math inline">\(A\)</span>,</li>
<li><span class="math inline">\(n_{t_i}^B\)</span> is the risk set size on the time <span class="math inline">\(t_i\)</span> in group <span class="math inline">\(B\)</span>,</li>
<li><span class="math inline">\(o_{t_i}\)</span> overall observed events in the time <span class="math inline">\(t_i\)</span> (<span class="math inline">\(o_{t_i} = o_{t_i}^A+o_{t_i}^B\)</span>),</li>
<li><span class="math inline">\(o_{t_i}^A\)</span> observed events in the time <span class="math inline">\(t_i\)</span> in group <span class="math inline">\(A\)</span>,</li>
<li><span class="math inline">\(o_{t_i}^B\)</span> observed events in the time <span class="math inline">\(t_i\)</span> in group <span class="math inline">\(B\)</span>,</li>
<li><span class="math inline">\(e_{t_i}\)</span> number of overall expected events in the time <span class="math inline">\(t_i\)</span> (<span class="math inline">\(e_{t_i} = e_{t_i}^A+e_{t_i}^B\)</span>),</li>
<li><span class="math inline">\(e_{t_i}^A\)</span> number of expected events in the time <span class="math inline">\(t_i\)</span> in group <span class="math inline">\(A\)</span>,</li>
<li><span class="math inline">\(e_{t_i}^B\)</span> number of expected events in the time <span class="math inline">\(t_i\)</span> in group <span class="math inline">\(B\)</span>,</li>
<li><span class="math inline">\(w_{t_i}\)</span> is a weight for the statistic,</li>
</ul>
<p>also remember about few notes</p>
<p><span class="math display">\[e_{t_i}^A = n_{t_i}^A \frac{o_{t_i}}{n_{t_i}}, \ \ \ \ \ \ \ \ \ \  e_{t_i}^B = n_{t_i}^B \frac{o_{t_i}}{n_{t_i}},\]</span> <span class="math display">\[e_{t_i}^A + e_{t_i}^B = o_{t_i}^A + o_{t_i}^B\]</span></p>
<p>that’s why we can substitute group <span class="math inline">\(A\)</span> with <span class="math inline">\(B\)</span> in <span class="math inline">\(U\)</span> and receive same results.</p>
<h1 id="weighted-log-rank-extensions">Weighted Log-rank extensions</h1>
<p>Regular Log-rank comparison uses <span class="math inline">\(w_{t_i} = 1\)</span> but many modifications to that approach have been proposed. The most popular modifications, called weighted Log-rank tests, are available in <code>?survMisc::comp</code></p>
<ul>
<li><code>n</code> Gehan and Breslow proposed to use <span class="math inline">\(w_{t_i} = n_{t_i}\)</span> (this is also called generalized Wilcoxon),</li>
<li><code>srqtN</code> Tharone and Ware proposed to use <span class="math inline">\(w_{t_i} = \sqrt{n_{t_i}}\)</span>,</li>
<li><code>S1</code> Peto-Peto’s modified survival estimate <span class="math inline">\(w_{t_i} = S1({t_i}) = \prod_{i=1}^{T}(1-\frac{e_{t_i}}{n_{t_i}+1})\)</span>,</li>
<li><code>S2</code> modified Peto-Peto (by Andersen) <span class="math inline">\(w_{t_i} = S2({t_i}) = \frac{S1({t_i})n_{t_i}}{n_{t_i}+1}\)</span>,</li>
<li><code>FH</code> Fleming-Harrington <span class="math inline">\(w_{t_i} = S(t_i)^p(1 - S(t_i))^q\)</span>.</li>
</ul>
<blockquote>
<p>Watch out for <code>FH</code> as I <a href="https://github.com/dardisco/survMisc/issues/15">submitted an info on survMisc repository</a> where I think their mathematical notation is misleading for Fleming-Harrington.</p>
</blockquote>
<h2 id="why-are-they-useful">Why are they useful?</h2>
<p>The regular Log-rank test is sensitive to detect differences in late survival times, where Gehan-Breslow and Tharone-Ware propositions might be used if one is interested in early differences in survival times. Peto-Peto modifications are also useful in early differences and are more robust (than Tharone-Whare or Gehan-Breslow) for situations where many observations are censored. The most flexible is Fleming-Harrington method for weights, where high <code>p</code> indicates detecting early differences and high <code>q</code> indicates detecting differences in late survival times. But there is always an issue on how to detect <code>p</code> and <code>q</code>.</p>
</blockquote>
</body>
</html>
