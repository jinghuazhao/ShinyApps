---
title: "Analysis report"
output: pdf_document
params:
  data: NA
---

## Notes

1. For html output, change the header to have "output: html_document".
2. rmarkdown requires that the default value of a parameter in the header not to be `NULL`, so I used `NA` for the default value.

```{r}
user_data <- with(params,data)
```

## The data structure

```{r}
knitr::kable(head(user_data),caption="The lung data from R/survival package")
```

## The Kaplan-Meier curve

The overal survival probability can be seen from the Kaplan-Meier curve.

```{r km, fig.height=6.5, fig.width=6.5}
library(survival)
plot(survfit(Surv(time, status) ~ 1, data = user_data),
             xlab = "Days",
             ylab = "Overall survival probability"
)
```

## The Cox model

```{r cox, fig.height=6.5, fig.width=6.5, message=FALSE}
coxfit <- coxph(Surv(time, status) ~ age + sex + wt.loss, data = user_data)

new_df <- with(user_data,
               data.frame(sex = c(1, 2),
                          age = rep(mean(age, na.rm = TRUE), 2),
                          wt.loss = rep(mean(wt.loss, na.rm = TRUE), 2)
               )
)
new_df

library(survminer)
fit <- survfit(coxfit, newdata = new_df)
ggsurvplot(fit, conf.int = TRUE, palette = "Dark2", censor = FALSE,
           surv.median.line = "hv", data=user_data)

```
