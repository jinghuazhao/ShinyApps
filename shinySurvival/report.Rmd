---
title: "Analysis report"
output: pdf_document
params:
  data: NA
---

```{r eval = FALSE, echo = FALSE}
# For html output, change the header to have "output: html_document".
#
# Note that due to an issue in rmarkdown, the default value of a parameter in
# the header cannot be `NULL`, so I used a default of `NA` for the default value
# of `n`.
```

## The data structure

```{r}
user_data <- with(params,data)
knitr::kable(head(user_data),caption="The lung data R/survival package")
```

## A Kaplan-Meier curve.

```{r km, fig.height=7, fig.width=7}
library(survival)
plot(survfit(Surv(time, status) ~ 1, data = user_data),
             xlab = "Days",
             ylab = "Overall survival probability"
)
```

## The Cox model

```{r cox, fig.height=7, fig.width=7}
coxfit <- coxph(Surv(time, status) ~ age + sex + wt.loss, data = user_data)

# Survival curves by sex with adjustment for age and wt.loss
# A new data frame is generated containing two rows, one for each value of sex;
# the other covariates are fixed to their average values
new_df <- with(user_data,
               data.frame(sex = c(1, 2),
                          age = rep(mean(age, na.rm = TRUE), 2),
                          wt.loss = rep(mean(wt.loss, na.rm = TRUE), 2)
               )
)
new_df

library(survminer)
fit <- survfit(coxfit, newdata = new_df)
ggsurvplot(fit, conf.int = TRUE, palette = "Dark2", censor = FALSE,
           surv.median.line = "hv", data=user_data)

```
