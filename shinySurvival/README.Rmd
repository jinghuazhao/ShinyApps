This is a very early attempt to seed Shiny projects via the familiar survival analysis whose source code is available from

[https://github.com/jinghuazhao/ShinyApps/](https://github.com/jinghuazhao/ShinyApps/)

An end-user can upload his/her own data for analysis and download the analysis report. The following aspects are experimented with data from 
R/survival package as follows:

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  out.extra = 'style="display:block; margin: auto"',
  fig.align = "center",
  fig.path = "www/",
  collapse = TRUE,
  comment = "#>",
  dev = "png")
```

```{r}
library(survival)
write.csv(survival::lung,file="lung.csv",quote=FALSE,row.names=FALSE)
```

# Data

This takes a local file in .csv or .tsv format, such as `lung.tsv` from above.

# Download

The input data can be saved in a variety of format -- is is actaully a template for downloading results.

# Model

Once the data is uploaded, this defines the model as in the example.

# Report

This is a file containing the commands and plots. For the current example, we have

## Kaplan-Meier curve

```{r km, fig.height=6.5, fig.width=6.5, echo=FALSE}
plot(survfit(Surv(time, status) ~ 1, data = lung), xlab = "Time",  ylab = "Overall survival probability")
```

## Cox survival curve


```{r cox, fig.height=6.5, fig.width=6.5, echo=FALSE, message=FALSE}
coxfit <- coxph(Surv(time, status) ~ age + sex + wt.loss, data = lung)

# Survival curves by sex with adjustment for age and wt.loss
# A new data frame is generated containing two rows, one for each value of sex;
# the other covariates are fixed to their average values
new_df <- with(lung,
               data.frame(sex = c(1, 2),
                          age = rep(mean(age, na.rm = TRUE), 2),
                          wt.loss = rep(mean(wt.loss, na.rm = TRUE), 2)
               )
)

library(survminer)
fit <- survfit(coxfit, newdata = new_df)
ggsurvplot(fit, conf.int = TRUE, palette = "Dark2", censor = FALSE,
           surv.median.line = "hv", data=lung)
unlink("lung.csv")
```
