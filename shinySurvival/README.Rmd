This is a very early attempt to seed Shiny projects via the familiar survival analysis whose source code is available from

[https://github.com/jinghuazhao/ShinyApps/](https://github.com/jinghuazhao/ShinyApps/)

An end-user can upload his/her own data for analysis and download the analysis report. The following aspects are experimented with data from 
R/survival package as follows:

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  out.extra = 'style="display:block; margin: auto"',
  fig.align = "center",
  fig.path = "www/",
  collapse = TRUE,
  comment = "#>",
  dev = "png")
```

```{r}
library(survival)
write.csv(survival::lung,file="lung.csv",quote=FALSE,row.names=FALSE)
```

# Data

This takes a local file in .csv or .tsv format, such as `lung.tsv` from above.

# Download

The input data can be saved in a variety of format -- is is actaully a template for downloading results.

# Model

Once the data is uploaded, this defines the model as in the example.

# Report

This is a file containing the commands and plots. For the current example, we have

## Kaplan-Meier curve

These were from vignettes of the survminer package.

```{r km, fig.height=6.5, fig.width=6.5, echo=FALSE, message=FALSE}
plot(survfit(Surv(time, status) ~ 1, data = lung),
             xlab = "Time",  ylab = "Overall survival probability", main = "Overall survival probability")
library(survminer)
fit <- survfit(Surv(time, status) ~ sex, data = lung)
ggsurvplot(fit, data = lung, pval = TRUE, pval.method = TRUE) + ggtitle("Log-rank (survdiff)")
ggsurvplot(fit, data = lung, pval = TRUE, pval.method = TRUE,
           log.rank.weights = "1") + ggtitle("Log-rank (comp)")
ggsurvplot(fit, data = lung, pval = TRUE, pval.method = TRUE,
           log.rank.weights = "n", pval.method.coord = c(5, 0.1),
           pval.method.size = 3) + ggtitle("Gehan-Breslow (generalized Wilcoxon)")
ggsurvplot(fit, data = lung, pval = TRUE, pval.method = TRUE,
           log.rank.weights = "sqrtN", pval.method.coord = c(3, 0.1),
           pval.method.size = 4) + ggtitle("Tharone-Ware")
ggsurvplot(fit, data = lung, pval = TRUE, pval.method = TRUE,
           log.rank.weights = "S1", pval.method.coord = c(5, 0.1),
           pval.method.size = 3) + ggtitle("Peto-Peto’s modified survival estimate")
ggsurvplot(fit, data = lung, pval = TRUE, pval.method = TRUE,
           log.rank.weights = "S2", pval.method.coord = c(5, 0.1),
           pval.method.size = 3) + ggtitle("modified Peto-Peto’s (by Andersen)")
ggsurvplot(fit, data = lung, pval = TRUE, pval.method = TRUE,
           log.rank.weights = "FH_p=1_q=1",
           pval.method.coord = c(5, 0.1),
           pval.method.size = 4) + ggtitle("Fleming-Harrington (p=1, q=1)")
```

## Cox survival curve


```{r cox, fig.height=6.5, fig.width=6.5, echo=FALSE, message=FALSE}
coxfit <- coxph(Surv(time, status) ~ age + sex + wt.loss, data = lung)

# Survival curves by sex with adjustment for age and wt.loss
# A new data frame is generated containing two rows, one for each value of sex;
# the other covariates are fixed to their average values
new_df <- with(lung,
               data.frame(sex = c(1, 2),
                          age = rep(mean(age, na.rm = TRUE), 2),
                          wt.loss = rep(mean(wt.loss, na.rm = TRUE), 2)
               )
)

fit <- survfit(coxfit, newdata = new_df)
ggsurvplot(fit, conf.int = TRUE, palette = "Dark2", censor = FALSE,
           surv.median.line = "hv", data=lung)
unlink("lung.csv")
```
